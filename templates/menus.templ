package templates

import (
    "strconv"
    "fmt"
)

type SideBarMenuParams struct {
    OpenAIKey string `db:"openai_key" json:"openai_key"`
    GroqKey string `db:"groq_key" json:"groq_key"`
}

templ SideBarMenu(params SideBarMenuParams) {
        <div 
            class="model-stats"
            hx-get="http://127.0.0.1:8090/stats"
            hx-target="this"
            hx-swap="innerHTML"
            hx-trigger="load"
        ></div>
        <!-- <form -->
        <!--     hx-put="http://127.0.0.1:8090/config" -->
        <!--     hx-target="this" -->
        <!--     hx-swap="beforeend" -->
        <!--     id="side-bar-menu" -->
        <!--     class="config-menu" -->
        <!-- > -->
        <!--     <input type="color" /> -->
        <!-- </form> -->
}

css percentStyle(percent float64) {
	width: { fmt.Sprintf("%f%%", percent * 100.0) };
	border-radius: 5px;
	height: 8px;
	background-color: green;
}

templ ModelStatsViewer(sortedKeys []string, total map[string]int, useful map[string]int, percent map[string]float64) {
    for _, model := range sortedKeys { 
        if model != "error" && model != "" {
            <div class="model-stats-item">
                <p class="model-stats-title">{ model }</p>
                <div class="model-stats-row">
                    <p class="model-stats-text">Total messages: </p>
                    <p class="model-stats-text">{ strconv.Itoa(total[model]) }</p>
                </div> 
                <div class="model-stats-row">
                    <p class="model-stats-text">Useful messages: </p>
                    if _, ok := useful[model]; ok {
                        <p class="model-stats-text">{ strconv.Itoa(useful[model]) }</p>
                    } else {
                        <p class="model-stats-text">0</p> 
                    }
                </div>
                <div style="background-color: black; width: 100%; border-radius: 5px; height: 8px; margin-top: 0.25rem;">
                    <div class={ percentStyle(percent[model]) }></div>
                </div>
            </div>
        }
    }
}

templ SettingsUpdated() {
    <p class="update-alert" _="on load wait 2s remove me">Settings updated successfully!</p>
}

templ SearchMenu(tagParams []TagParams, models []string) {
    <div id="side-bar-menu">
        <form
            hx-post="http://127.0.0.1:8090/search"
            hx-target="#search-results"
            hx-swap="innerHTML"
            id="side-bar-menu"
            class="search-menu"
        >
            <div class="search-text-row">
                <label class="search-input-label">Search:</label>
                <input name="search-input" class="search-input"/>
            </div>

            <select class="search-filter" name="tag">
                <option value="any">All tags</option>
                for _, tag := range tagParams {
                    <option value={ tag.Id }> { tag.Value } </option>
                }
            </select>

            <select class="search-filter" name="model">
                <option value="any">All used models</option>
                for _, model := range models {
                    <option value={ model }> { model } </option>
                }
            </select>

            <select class="search-filter" name="useful">
                <option value="any">Any usefulness</option>
                <option value="useful">Only threads with useful messages</option>
                <option value="not-useful">Only threads without useful messages</option>
            </select>

            <button
                class="submit-search-button"
            >
                Search
            </button>
        </form>
        <div id="search-results"/>
    </div>
}
