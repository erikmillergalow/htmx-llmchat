<!doctype html>
<html lang="en-US">
    <head>
        <meta charset="utf-8" />
        <title>HTMXLLMChat</title>
        <link rel="stylesheet" href="./styles.css">
        <script src="lib/htmx.min.js"></script>
        <script src="lib/htmx.ws.js"></script>
        <script src="lib/_hyperscript.min.js"></script>

    </head>
    <body>
        <div class="ui-container">
            <div class="threads-sidebar">
                <div class="sidebar-header">
                    <div
                        hx-get="http://127.0.0.1:8090/config"
                        hx-trigger="click"
                        hx-target="#threads-list"
                        hx-swap="innerHTML"
                    >
                        <svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="M20 3H4c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2zM4 19V7h6v12H4zm8 0V7h8V5l.002 14H12z"></path><path d="M6 10h2v2H6zm0 4h2v2H6z"></path></svg>
                    </div>

                    <div
                        hx-post="http://127.0.0.1:8090/thread/create"
                        hx-trigger="click"
                        hx-target="#threads-list"
                        hx-swap="none"
                    >
                        <svg class="new-thread-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="M16 2H8C4.691 2 2 4.691 2 8v13a1 1 0 0 0 1 1h13c3.309 0 6-2.691 6-6V8c0-3.309-2.691-6-6-6zm4 14c0 2.206-1.794 4-4 4H4V8c0-2.206 1.794-4 4-4h8c2.206 0 4 1.794 4 4v8z"></path><path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4z"></path></svg>
                    </div>
                </div>
                <div
                    id="threads-list"
                    class="threads-list"
                    hx-get="http://127.0.0.1:8090/threads"
                    hx-target="this"
                    hx-trigger="load"
                >
                </div>
            </div>

            <div class="chat-container">
                <div class="chat-window" id="chat-window">
                    <div class="chat-title-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="M4 18h2v4.081L11.101 18H16c1.103 0 2-.897 2-2V8c0-1.103-.897-2-2-2H4c-1.103 0-2 .897-2 2v8c0 1.103.897 2 2 2z"></path><path d="M20 2H8c-1.103 0-2 .897-2 2h12c1.103 0 2 .897 2 2v8c1.103 0 2-.897 2-2V4c0-1.103-.897-2-2-2z"></path></svg>
                        <p id="thread-title" class="thread-title">Create or select thread from the sidebar</p>
                        <select
                            hx-get="/model"
                            hx-trigger="change"
                            hx-target="this"
                            hx-swap="afterend"
                            name="model"
                            class="model-select"
                        >
                            <option value="openai">OpenAI API</option>
                            <option value="groq">Groq API</option>
                        </select>
                    </div>

                    <!-- fill message history here, stream responses --> 
                    <div class="messages-container" id="chat-messages">

                    </div>
                </div>

                <div
                    class="input-container"
                    hx-ext="ws"
                    ws-connect="http://127.0.0.1:8090/ws"
                    hx-on:htmx:ws-after-send="document.querySelector('#sender-form').reset()"
                >
                    <form
                        id="sender-form"
                        class="send-message-form"
                        ws-send
                        hx-trigger="keyup[keyCode==13]"
                        hx-on::after-request="console.log('after')"
                    >
                        <input id="thread-id-chat" name="thread-id-chat" type="hidden">
                        <textarea
                            disabled
                            form="sender-form"
                            id="message-input"
                            name="new-message"
                            class="message-input"
                            placeholder="Enter prompt..."
                        ></textarea>
                        <button
                            ws-send
                            class="send-message-button"
                        >
                            Send
                        </Button>
                    </form>

                </div>
            </div>
        </div>
    </body>
    <script>
        document.addEventListener("htmx:wsAfterMessage", e => {
            const messagesDiv = document.getElementById("chat-messages");

            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        })
    </script>

</html>
